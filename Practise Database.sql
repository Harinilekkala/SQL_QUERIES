CREATE DATABASE PRACTICE
USE PRACTICE

-- Creating table for company
-----------------------------------------------------------------------------------------
CREATE TABLE COMPANIES(
COMPANY_ID INT PRIMARY KEY NOT NULL,
COMPANY_NAME VARCHAR(25) NOT NULL)

INSERT INTO COMPANIES VALUES(101,'ABC')
INSERT INTO COMPANIES VALUES(102,'XYZ')

select * from COMPANIES;

---------------------------------------------------------------------------------

--CREATING EMPLOYEE_DETAILS TABLE

CREATE TABLE EMPLOYEES_DETAILS(
EMP_ID INT PRIMARY KEY NOT NULL,
NAME VARCHAR(50) NOT NULL,
GENDER VARCHAR(2) NOT NULL,
PHONE FLOAT NOT NULL,
EMAIL VARCHAR(50) NOT NULL,
START DATE  NOT NULL,
COMPANY_ID INT NOT NULL)

select * from EMPLOYEES_DETAILS;

--ALTER TABLE EMPLOYEES_DETAILS ADD START_DATE DATE NOT NULL
--ALTER TABLE EMPLOYEES_DETAILS ADD COMPANY_ID INT NOT NULL DEFAULT(0)

INSERT INTO EMPLOYEES_DETAILS VALUES(1,'Terissa','F',9087654321,'terissa@gmail.com','2018-05-01',101)
INSERT INTO EMPLOYEES_DETAILS VALUES(2,'Hari','M',9807654321,'hari@gmail.com','2022-05-10',101)
INSERT INTO EMPLOYEES_DETAILS VALUES(3,'Likhitha','F',9123456780,'likhitha@gmail.com','2022-05-10',101)
INSERT INTO EMPLOYEES_DETAILS VALUES(4,'sony','F',8907651234,'sony@gmail.com','2021-10-05',101)

-------------------------------------------------------------------------------------------------------------------------------------

--CREATING DEPARTMENT_DETAILS TABLE

CREATE TABLE DEPARTMENT_DETAILS(
DEPT_ID INT PRIMARY KEY NOT NULL,
DEPT_NAME VARCHAR(25) NOT NULL)

INSERT INTO DEPARTMENT_DETAILS VALUES(11,'Administration'),(12,'Sales'),(13,'Marketing'),(14,'Production')

select * from DEPARTMENT_DETAILS

----------------------------------------------------------------------------------------------------------------------------

--CREATING EMPLOYEE_ADDRESS TABLE

CREATE TABLE EMP_ADDRESS(
NAME VARCHAR(50) PRIMARY KEY NOT NULL,
ADDRESS VARCHAR(25) NOT NULL,
CITY VARCHAR(25) NOT NULL,
STATE VARCHAR(25) NOT NULL,
ZIP_CODE INT NOT NULL)

INSERT INTO EMP_ADDRESS VALUES('Harini','15C','Chennai','Tamil Nadu',600001)
INSERT INTO EMP_ADDRESS VALUES('Likitha','11A','Komarapalayam','Tamil Nadu',654321)
INSERT INTO EMP_ADDRESS VALUES('Nandini','12D','Coimbatore','Tamil Nadu',645231)
INSERT INTO EMP_ADDRESS VALUES('Sunitha','14C','Dindigul','Tamil Nadu',632154)

select * from EMP_ADDRESS

-----------------------------------------------------------------------------------------------------------------------------------------------

--CREATING EMPLOYEE_SALARY TABLE

CREATE TABLE EMP_SALARY(
EMP_ID INT PRIMARY KEY NOT NULL,
NAME VARCHAR(50) NOT NULL,
BASIC_PAY FLOAT NOT NULL,
DEDUCTIONS FLOAT NOT NULL,
TAXABLE_PAY FLOAT NOT NULL,
INCOME_TAX FLOAT NOT NULL,
NET_PAY FLOAT NOT NULL)

INSERT INTO EMP_SALARY VALUES(1,'Terissa',50000,1000,1000,2000,46000)
INSERT INTO EMP_SALARY VALUES(2,'Elavarasu',30000,1000,1000,2000,26000)
INSERT INTO EMP_SALARY VALUES(3,'Nantha',40000,1000,1000,2000,36000)
INSERT INTO EMP_SALARY VALUES(4,'Senthil',50000,1000,1000,2000,46000)

select * from EMP_SALARY;
-----------------------------------------------------------------------------------------------------------------

--CREATING EMPLOYEE_DEPARTMENT TABLE
CREATE TABLE EMP_DEPARTMENT(
EMP_ID INT NOT NULL,
NAME VARCHAR(50) NOT NULL,
DEPT_ID INT NOT NULL,
DEPT_NAME VARCHAR(25) NOT NULL)

INSERT INTO EMP_DEPARTMENT VALUES(1,'Terissa',12,'Sales'),(1,'Terissa',13,'Marketing'),(2,'Harini',14,'Production'),(3,'Nandini',14,'Production'),(4,'Sunitha',11,'Administration')

select * from EMP_DEPARTMENT;

--ADDING CONSTRAINTS TO THE TABLES
ALTER TABLE EMPLOYEES_DETAILS ADD CONSTRAINT FK_COMPANY_ID_FROM_COMPANIES FOREIGN KEY(COMPANY_ID) REFERENCES COMPANIES(COMPANY_ID) ON UPDATE CASCADE ON DELETE CASCADE
ALTER TABLE EMP_SALARY ADD CONSTRAINT FK_EMPLOYEE_ID_FROM_EMPLOYEE_DETAILS FOREIGN KEY(EMP_ID) REFERENCES EMPLOYEES_DETAILS(EMP_ID) ON UPDATE CASCADE ON DELETE CASCADE
ALTER TABLE EMP_DEPARTMENT ADD CONSTRAINT FK_NAME_FROM_EMP_ADDRESS FOREIGN KEY(NAME) REFERENCES EMP_ADDRESS(NAME) ON UPDATE CASCADE ON DELETE CASCADE
ALTER TABLE EMP_DEPARTMENT ADD CONSTRAINT FK_EMP_ID_FROM_EMPLOYEE_DETAILS FOREIGN KEY(EMP_ID) REFERENCES EMPLOYEES_DETAILS(EMP_ID) ON UPDATE CASCADE ON DELETE CASCADE
ALTER TABLE EMP_DEPARTMENT ADD CONSTRAINT FK_DEPT_ID_FROM_DEPARTMENT_DETAILS FOREIGN KEY(DEPT_ID) REFERENCES DEPARTMENT_DETAILS(DEPT_ID) ON UPDATE CASCADE ON DELETE CASCADE

SELECT GENDER,SUM(BASIC_PAY) AS SALARY_SUM FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,MIN(BASIC_PAY) AS MIN_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,MAX(BASIC_PAY) AS MAX_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,AVG(BASIC_PAY) AS AVG_SALARY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER
SELECT GENDER,COUNT(GENDER) AS EMP_COUNT FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID GROUP BY GENDER

--UC12:
SELECT ED.EMP_ID,ED.NAME,GENDER,PHONE,START,BASIC_PAY,DEDUCTIONS,TAXABLE_PAY,INCOME_TAX,NET_PAY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES 
ON ED.EMP_ID = ES.EMP_ID WHERE START BETWEEN '2022-01-01' AND CURRENT_TIMESTAMP

SELECT ED.NAME,BASIC_PAY FROM EMPLOYEES_DETAILS ED INNER JOIN EMP_SALARY ES ON ED.EMP_ID = ES.EMP_ID WHERE ED.NAME = 'Harini'

SELECT * FROM COMPANIES
SELECT * FROM EMPLOYEES_DETAILS
SELECT * FROM EMP_ADDRESS
SELECT * FROM DEPARTMENT_DETAILS
SELECT * FROM EMP_SALARY
SELECT * FROM EMP_DEPARTMENT

SELECT C.COMPANY_ID,COMPANY_NAME,DD.DEPT_ID,DD.DEPT_NAME,ED.EMP_ID,EA.NAME,GENDER,PHONE,EMAIL,START,ADDRESS,CITY,STATE,ZIP_CODE,BASIC_PAY,NET_PAY FROM
COMPANIES C INNER JOIN EMPLOYEES_DETAILS ED ON C.COMPANY_ID = ED.COMPANY_ID INNER JOIN EMP_DEPARTMENT EMPD ON ED.EMP_ID = EMPD.EMP_ID INNER JOIN DEPARTMENT_DETAILS DD
ON DD.DEPT_ID = EMPD.DEPT_ID INNER JOIN EMP_ADDRESS EA ON EA.NAME = ED.NAME INNER JOIN EMP_SALARY ES ON ES.EMP_ID = ED.EMP_ID

--UC1 ADO.NET
--PROCEDURE FOR CHECKING CONNECTIVITY
GO
CREATE PROCEDURE ConnectivityCheck
AS
BEGIN
SELECT * FROM COMPANIES
END

--PROCEDURE TO ADD DATA INTO THE TABLE
GO
CREATE OR ALTER PROCEDURE [dbo].[AddDataTo_Companies]
(@COMPANY_ID INT,
@COMPANY_NAME VARCHAR(50))
AS
BEGIN
INSERT INTO COMPANIES VALUES(@COMPANY_ID,@COMPANY_NAME)
END

--PROCEDURE FOR UPDATING DATA IN THE TABLE
GO
CREATE OR ALTER PROCEDURE [dbo].[UpdateEmployee_Salary]
(@NAME VARCHAR(50),
@BASIC_PAY FLOAT)
AS
BEGIN
UPDATE EMP_SALARY SET BASIC_PAY = @BASIC_PAY WHERE NAME = @NAME
END

--PROCEDURE FOR DELETING DATA IN THE TABLE
GO
CREATE OR ALTER PROCEDURE [dbo].[DeleteCompany]
(@COMPANY_NAME VARCHAR(25))
AS
BEGIN
DELETE FROM COMPANIES WHERE COMPANY_NAME = @COMPANY_NAME
END

SELECT * FROM COMPANIES